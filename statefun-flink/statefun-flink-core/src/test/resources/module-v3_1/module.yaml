# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

version: "3.1"

module:
  meta:
    type: remote
  spec:
    endpoints:
      - kind: io.statefun.endpoints.v2/http
        spec:
          functions: com.foo.bar/*
          urlPathTemplate: http://bar.foo.com:8080/functions/{function.name}
          maxNumBatchRequests: 10000
          transport:
            timeouts:
              call: 1minutes
              connect: 10seconds
              read: 10second
              write: 10seconds
      - kind: io.statefun.endpoints.v2/http
        spec:
          functions: com.foo.bar.2/*
          urlPathTemplate: http://2.bar.foo.com:8080/functions/{function.name}
          transport:
            type: my.custom/http.transport.type
            property1: value1
            property2:
              - k1: v1
              - k2: v2
      - kind: io.statefun.endpoints.v2/http
        spec:
          functions: com.foo.bar/specific_function
          urlPathTemplate: http://bar.foo.com:8080/functions/abc
      - kind: io.statefun.endpoints.v2/http
        spec:
          functions: com.other.namespace/hello
          urlPathTemplate: http://namespace.other.com:8080/hello
    ingresses:
      - kind: io.statefun.kafka/ingress
        spec:
          id: com.mycomp.igal/names
          address: kafka-broker:9092
          consumerGroupId: my-group-id
          topics:
            - topic: topic-1
              valueType: com.googleapis/com.mycomp.foo.MessageA
              targets:
                - com.mycomp.foo/function-1
                - com.mycomp.foo/function-2
            - topic: topic-2
              valueType: com.googleapis/com.mycomp.foo.MessageB
              targets:
                - com.mycomp.foo/function-2
          autoOffsetResetPosition: earliest
          startupPosition:
            type: earliest
          properties:
            - foo.config: bar
    egresses:
      - kind: io.statefun.kafka/egress
        spec:
          id: com.mycomp.foo/bar
          address: kafka-broker:9092
          deliverySemantic:
            type: exactly-once
            transactionTimeoutMillis: 100000
          properties:
            - foo.config: bar
